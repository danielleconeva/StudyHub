<div class="form-wrapper">

  <div class="glass-bubble" style="top: 12%; left: 10%;"></div>
  <div class="glass-bubble" style="top: 25%; right: 12%;"></div>
  <div class="glass-bubble" style="bottom: 20%; left: 16%;"></div>
  <div class="glass-bubble" style="bottom: 2%; right: 29%;"></div>

  <form [formGroup]="signupForm" (ngSubmit)="onSubmit()">
    <fieldset>

      <div class="form-header">
        <h1>StudyHub</h1>
        <p>Create your account</p>
        <p class="adittional-text" style="font-size: 0.9rem; color: #7e8194; font-weight: 500;">
          Join thousands of students achieving their goals.
        </p>
      </div>

      <div class="form-group">
        <label for="username">Username</label>
        <input id="username" type="text" placeholder="Enter your username" formControlName="username"
          [class.input-error]="username?.invalid && (username?.dirty || username?.touched)"
          [class.input-valid]="username?.valid && !username?.pending && (username?.dirty || username?.touched)" />
        @if (username?.errors && (username?.dirty || username?.touched)) {
        <p class="error-msg">
          @if (username?.errors?.['required']) { Username is required. }
          @if (username?.errors?.['usernameTaken']) { This username is already taken. }
        </p>
        }
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="Enter your email" formControlName="email"
          [class.input-error]="email?.invalid && (email?.dirty || email?.touched)"
          [class.input-valid]="email?.valid && !email?.pending && (email?.dirty || email?.touched)" />
        @if (email?.errors && (email?.dirty || email?.touched)) {
        <p class="error-msg">
          @if (email?.errors?.['required']) { Email is required. }
          @if (email?.errors?.['email']) { Invalid email format. }
          @if (email?.errors?.['emailTaken']) { This email is already taken. }
        </p>
        }
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <div class="password-wrapper">
          <input id="password" [type]="showPassword ? 'text' : 'password'" placeholder="Create a password"
            formControlName="password" [class.input-error]="password?.invalid && (password?.dirty || password?.touched)"
            [class.input-valid]="password?.valid && (password?.dirty || password?.touched)" />
          <span class="password-toggle" (click)="showPassword = !showPassword" title="Toggle password visibility">
            <i class="fa" [ngClass]="showPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
          </span>
        </div>
        @if (password?.invalid && (password?.dirty || password?.touched)) {
        <p class="error-msg">
          @if (password?.errors?.['required']) { Password is required. }
          @if (password?.errors?.['minlength']) { At least 6 characters required. }
        </p>
        }
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirm Password</label>
        <div class="password-wrapper">
          <input id="confirmPassword" [type]="showPassword ? 'text' : 'password'" placeholder="Confirm your password"
            formControlName="confirmPassword"
            [class.input-error]="signupForm.errors?.['passwordMismatch'] && (confirmPassword?.dirty || confirmPassword?.touched)"
            [class.input-valid]="!signupForm.errors?.['passwordMismatch'] && confirmPassword?.valid && (confirmPassword?.dirty || confirmPassword?.touched)" />
          <span class="password-toggle" (click)="showPassword = !showPassword" title="Toggle password visibility">
            <i class="fa" [ngClass]="showPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
          </span>
        </div>
        @if (signupForm.errors?.['passwordMismatch'] && (confirmPassword?.dirty || confirmPassword?.touched)) {
        <p class="error-msg">Passwords do not match.</p>
        }
      </div>

      <div class="form-actions">
        <button type="submit" [disabled]="signupForm.invalid || signupForm.pending || isSubmitting">
          {{ isSubmitting ? 'Registering...' : 'Create Account' }}
        </button>
      </div>

      <div class="form-footer">
        <p>
          Already have an account?
          <a routerLink="/sign-in">Sign in</a>
        </p>
        <p>
          <a routerLink="/">‚Üê Back to home</a>
        </p>
      </div>

    </fieldset>
  </form>
</div>