<div class="wrapper">

    <div class="details-container">

        <a routerLink="/explore" class="back-link">
            <i class="fas fa-arrow-left"></i> Back to Explore
        </a>

        <div class="title-section">
            <h1 class="title">{{ page()?.title }}</h1>
            <div class="meta">
                <span class="tag">{{ page()?.subject }}</span>
                <span class="visibility">
                    <i class="fas fa-globe"></i> Public
                </span>
                <span class="likes">
                    <i class="fas fa-heart"></i> {{ page()?.likesCount ?? 0 }}
                </span>
                <span class="date">{{ formatDate(page()?.createdAt ?? '') }}</span>
            </div>
        </div>

        <section class="section">
            <h2 class="section-title">
                <i class="fas fa-file-alt"></i> Study Notes
            </h2>
            <p class="notes" [innerHTML]="page()?.notes"></p>
        </section>

        <section class="section">
            <h2 class="section-title">
                <i class="fas fa-book-open"></i> Syllabus
            </h2>
            <ul class="syllabus-list">
                <li *ngFor="let item of page()?.syllabus">
                    <input type="checkbox" [checked]="item.done" disabled />
                    {{ item.text }}
                </li>
            </ul>
        </section>

        <section class="section">
            <h2 class="section-title">
                <i class="fas fa-link"></i> Resources
            </h2>
            <ul class="resources">
                <li *ngFor="let link of page()?.resources">
                    <a [href]="link" target="_blank">{{ link }}</a>
                </li>
            </ul>
        </section>

        <section class="section comments-section" id="comments">
            <h2 class="section-title">
                <i class="far fa-comment"></i> Comments ({{ comments().length }})
            </h2>

            <div class="comment" *ngFor="let c of comments()">
                <div class="avatar">{{ c.username[0] }}</div>
                <div class="content">
                    <div class="header">
                        <span class="username">{{ c.username }}</span>
                        <span class="date">{{ formatDate(c.createdAt) }}</span>

                        @if (c.userId === currentUserId()) {
                        <button class="delete-btn" (click)="onDeleteComment(c)">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                        }
                    </div>

                    <p class="text">{{ c.text }}</p>
                </div>
            </div>

            @if (isLoggedIn()) {
            <form class="comment-form" (submit)="onCommentSubmit($event)">
                <div class="avatar you">You</div>
                <textarea placeholder="Add a comment..." [(ngModel)]="newComment" name="newComment" required></textarea>
                <button type="submit">Post Comment</button>
            </form>
            }

        </section>
    </div>
</div>